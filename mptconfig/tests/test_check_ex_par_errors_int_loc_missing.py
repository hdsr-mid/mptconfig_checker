from mptconfig.checker import MptConfigChecker
from mptconfig.excel import ExcelSheet
from mptconfig.excel import ExcelSheetTypeChoices
from mptconfig.tests.fixtures import patched_path_constants_1
from mptconfig.tests.fixtures import patched_path_constants_2

import pandas as pd  # noqa pandas comes with geopandas


# silence flake8 errors
_patched_path_constants_1 = patched_path_constants_1
_patched_path_constants_2 = patched_path_constants_2

expected_df_ex_par_1_and_2 = pd.DataFrame(
    {
        "internalLocation": {
            0: "KW100521",
            1: "KW101011",
            2: "KW104421",
            3: "KW104431",
            4: "KW105012",
            5: "KW105013",
            6: "KW105014",
            7: "KW105711",
            8: "KW105911",
            9: "KW106511",
            10: "KW106821",
            11: "KW108911",
            12: "KW109311",
            13: "KW110421",
            14: "KW211511",
            15: "KW211811",
            16: "KW212511",
            17: "KW212711",
            18: "KW212813",
            19: "KW212814",
            20: "KW212815",
            21: "KW212816",
            22: "KW213012",
            23: "KW213013",
            24: "KW213121",
            25: "KW213411",
            26: "KW213412",
            27: "KW214511",
            28: "KW216013",
            29: "KW217311",
            30: "KW217811",
            31: "KW217911",
            32: "KW218011",
            33: "KW218221",
            34: "KW218231",
            35: "KW218411",
            36: "KW218619",
            37: "KW219121",
            38: "KW219131",
            39: "KW320111",
            40: "KW320112",
            41: "KW320411",
            42: "KW322111",
            43: "KW322815",
            44: "KW322821",
            45: "KW322831",
            46: "KW322911",
            47: "KW323515",
            48: "KW323613",
            49: "KW323614",
            50: "KW325111",
            51: "KW325211",
            52: "KW431014",
            53: "KW431114",
            54: "KW431713",
            55: "KW432224",
            56: "KW432611",
            57: "KW432711",
            58: "KW432811",
            59: "KW432911",
            60: "KW432912",
            61: "KW432913",
            62: "KW433011",
            63: "KW433115",
            64: "KW433121",
            65: "KW433511",
            66: "KW433521",
            67: "KW433711",
            68: "KW433811",
            69: "KW435013",
            70: "KW435412",
            71: "KW435413",
            72: "KW435511",
            73: "KW436011",
            74: "KW436115",
            75: "KW436415",
            76: "KW437015",
            77: "KW437211",
            78: "KW437221",
            79: "KW438311",
            80: "KW438511",
            81: "KW439211",
            82: "KW439421",
            83: "KW440011",
            84: "KW440311",
            85: "KW440411",
            86: "KW440811",
            87: "KW440812",
            88: "KW441011",
        },
        "locationType": {
            0: "subloc",
            1: "subloc",
            2: "subloc",
            3: "subloc",
            4: "subloc",
            5: "subloc",
            6: "subloc",
            7: "subloc",
            8: "subloc",
            9: "subloc",
            10: "subloc",
            11: "subloc",
            12: "subloc",
            13: "subloc",
            14: "subloc",
            15: "subloc",
            16: "subloc",
            17: "subloc",
            18: "subloc",
            19: "subloc",
            20: "subloc",
            21: "subloc",
            22: "subloc",
            23: "subloc",
            24: "subloc",
            25: "subloc",
            26: "subloc",
            27: "subloc",
            28: "subloc",
            29: "subloc",
            30: "subloc",
            31: "subloc",
            32: "subloc",
            33: "subloc",
            34: "subloc",
            35: "subloc",
            36: "subloc",
            37: "subloc",
            38: "subloc",
            39: "subloc",
            40: "subloc",
            41: "subloc",
            42: "subloc",
            43: "subloc",
            44: "subloc",
            45: "subloc",
            46: "subloc",
            47: "subloc",
            48: "subloc",
            49: "subloc",
            50: "subloc",
            51: "subloc",
            52: "subloc",
            53: "subloc",
            54: "subloc",
            55: "subloc",
            56: "subloc",
            57: "subloc",
            59: "subloc",
            58: "subloc",
            60: "subloc",
            61: "subloc",
            62: "subloc",
            63: "subloc",
            64: "subloc",
            65: "subloc",
            66: "subloc",
            67: "subloc",
            68: "subloc",
            69: "subloc",
            70: "subloc",
            71: "subloc",
            72: "subloc",
            73: "subloc",
            74: "subloc",
            75: "subloc",
            76: "subloc",
            77: "subloc",
            78: "subloc",
            79: "subloc",
            80: "subloc",
            81: "subloc",
            82: "subloc",
            83: "subloc",
            84: "subloc",
            85: "subloc",
            86: "subloc",
            87: "subloc",
            88: "subloc",
        },
        "ex_par_error": {
            0: "",
            1: "",
            2: "",
            3: "",
            4: "",
            5: "",
            6: "",
            7: "",
            8: "",
            9: "",
            10: "",
            11: "",
            12: "",
            13: "",
            14: "",
            15: "",
            16: "",
            17: "",
            18: "",
            19: "",
            20: "",
            21: "",
            22: "",
            23: "",
            24: "",
            25: "",
            26: "",
            27: "",
            28: "",
            29: "",
            30: "",
            31: "",
            32: "",
            33: "Q1",
            34: "Q2",
            35: "",
            36: "",
            37: "",
            38: "",
            39: "",
            40: "",
            41: "",
            42: "",
            43: "",
            44: "",
            45: "",
            46: "",
            47: "",
            48: "",
            49: "",
            50: "",
            51: "",
            52: "",
            53: "",
            54: "",
            55: "",
            56: "",
            57: "",
            58: "",
            59: "",
            60: "",
            61: "",
            62: "",
            63: "",
            64: "",
            65: "",
            66: "",
            67: "",
            68: "",
            69: "",
            70: "",
            71: "",
            72: "",
            73: "",
            74: "",
            75: "",
            76: "",
            77: "",
            78: "",
            79: "",
            80: "",
            81: "",
            82: "",
            83: "",
            84: "",
            85: "",
            86: "",
            87: "",
            88: "",
        },
        "types": {
            0: "schuif",
            1: "schuif,stuw,vispassage",
            2: "schuif",
            3: "schuif",
            4: "debietmeter,schuif,totaal",
            5: "debietmeter,schuif,totaal",
            6: "debietmeter,schuif,totaal",
            7: "schuif",
            8: "schuif",
            9: "schuif",
            10: "schuif",
            11: "schuif",
            12: "schuif",
            13: "schuif",
            14: "schuif",
            15: "schuif",
            16: "schuif",
            17: "schuif",
            18: "debietmeter,krooshek,schuif,totaal",
            19: "debietmeter,krooshek,schuif,totaal",
            20: "debietmeter,krooshek,schuif,totaal",
            21: "debietmeter,krooshek,schuif,totaal",
            22: "debietmeter,schuif,totaal",
            23: "debietmeter,schuif,totaal",
            24: "schuif",
            25: "schuif,totaal",
            26: "schuif,totaal",
            27: "schuif",
            28: "krooshek,pompvijzel,schuif",
            29: "schuif",
            30: "schuif",
            31: "schuif",
            32: "schuif",
            33: "afsluiter",
            34: "afsluiter",
            35: "schuif",
            36: "krooshek,pompvijzel,afsluiter,totaal,vispassage",
            37: "schuif",
            38: "schuif",
            39: "schuif,totaal",
            40: "schuif,totaal",
            41: "schuif",
            42: "schuif",
            43: "krooshek,pompvijzel,schuif,totaal",
            44: "schuif",
            45: "schuif",
            46: "schuif",
            47: "krooshek,pompvijzel,schuif,totaal",
            48: "krooshek,pompvijzel,schuif,totaal",
            49: "krooshek,pompvijzel,schuif,totaal",
            50: "schuif",
            51: "schuif",
            52: "krooshek,pompvijzel,schuif,totaal",
            53: "krooshek,pompvijzel,schuif,totaal",
            54: "krooshek,pompvijzel,schuif,totaal",
            55: "krooshek,pompvijzel,schuif,totaal,vispassage",
            56: "schuif,debietmeter",
            57: "schuif",
            58: "schuif",
            59: "schuif,stuw,totaal",
            60: "schuif,stuw,totaal",
            61: "schuif,stuw,totaal",
            62: "debietmeter,schuif",
            63: "krooshek,pompvijzel,schuif,totaal,vispassage",
            64: "schuif",
            65: "schuif",
            66: "schuif",
            67: "schuif",
            68: "schuif",
            69: "krooshek,pompvijzel,schuif,totaal",
            70: "krooshek,schuif,totaal,vispassage",
            71: "krooshek,schuif,totaal,vispassage",
            72: "schuif",
            73: "schuif,vispassage",
            74: "krooshek,pompvijzel,schuif,totaal",
            75: "krooshek,pompvijzel,schuif,totaal,vispassage",
            76: "krooshek,pompvijzel,schuif,totaal,vispassage",
            77: "schuif",
            78: "schuif",
            79: "schuif",
            80: "schuif",
            81: "schuif",
            82: "schuif",
            83: "schuif",
            84: "schuif",
            85: "schuif",
            86: "krooshek,pompvijzel,stuw,totaal,vispassage",
            87: "krooshek,pompvijzel,stuw,totaal,vispassage",
            88: "schuif",
        },
        "FQ": {
            0: False,
            1: False,
            2: False,
            3: False,
            4: False,
            5: False,
            6: False,
            7: False,
            8: False,
            9: False,
            10: False,
            11: False,
            12: False,
            13: False,
            14: False,
            15: False,
            16: False,
            17: False,
            18: False,
            19: False,
            20: False,
            21: False,
            22: False,
            23: False,
            24: False,
            25: False,
            26: False,
            27: False,
            28: False,
            29: False,
            30: False,
            31: False,
            32: False,
            33: False,
            34: False,
            35: False,
            36: False,
            37: False,
            38: False,
            39: False,
            40: False,
            41: False,
            42: False,
            43: False,
            44: False,
            45: False,
            46: False,
            47: False,
            48: False,
            49: False,
            50: False,
            51: False,
            52: False,
            53: False,
            54: False,
            55: False,
            56: False,
            57: False,
            58: False,
            59: False,
            60: False,
            61: False,
            62: False,
            63: False,
            64: False,
            65: False,
            66: False,
            67: False,
            68: False,
            69: False,
            70: False,
            71: False,
            72: False,
            73: False,
            74: False,
            75: False,
            76: False,
            77: False,
            78: False,
            79: False,
            80: False,
            81: False,
            82: False,
            83: False,
            84: False,
            85: False,
            86: False,
            87: False,
            88: False,
        },
        "I.X": {
            0: False,
            1: False,
            2: False,
            3: False,
            4: False,
            5: False,
            6: False,
            7: False,
            8: False,
            9: False,
            10: False,
            11: False,
            12: False,
            13: False,
            14: False,
            15: False,
            16: False,
            17: False,
            18: False,
            19: False,
            20: False,
            21: False,
            22: False,
            23: False,
            24: False,
            25: False,
            26: False,
            27: False,
            28: False,
            29: False,
            30: False,
            31: False,
            32: False,
            33: False,
            34: False,
            35: False,
            36: False,
            37: False,
            38: False,
            39: False,
            40: False,
            41: False,
            42: False,
            43: False,
            44: False,
            45: False,
            46: False,
            47: False,
            48: False,
            49: False,
            50: False,
            51: False,
            52: False,
            53: False,
            54: False,
            55: False,
            56: False,
            57: False,
            58: False,
            59: False,
            60: False,
            61: False,
            62: False,
            63: False,
            64: False,
            65: False,
            66: False,
            67: False,
            68: False,
            69: False,
            70: False,
            71: False,
            72: False,
            73: False,
            74: False,
            75: False,
            76: False,
            77: False,
            78: False,
            79: False,
            80: False,
            81: False,
            82: False,
            83: False,
            84: False,
            85: False,
            86: True,
            87: True,
            88: False,
        },
        "IX.": {
            0: False,
            1: False,
            2: False,
            3: False,
            4: False,
            5: False,
            6: False,
            7: False,
            8: False,
            9: False,
            10: False,
            11: False,
            12: False,
            13: False,
            14: False,
            15: False,
            16: False,
            17: False,
            18: False,
            19: False,
            20: False,
            21: False,
            22: False,
            23: False,
            24: False,
            25: False,
            26: False,
            27: False,
            28: False,
            29: False,
            30: False,
            31: False,
            32: False,
            33: False,
            34: False,
            35: False,
            36: False,
            37: False,
            38: False,
            39: False,
            40: False,
            41: False,
            42: False,
            43: False,
            44: False,
            45: False,
            46: False,
            47: False,
            48: False,
            49: False,
            50: False,
            51: False,
            52: False,
            53: False,
            54: False,
            55: False,
            56: False,
            57: False,
            58: False,
            59: False,
            60: False,
            61: False,
            62: False,
            63: False,
            64: False,
            65: False,
            66: False,
            67: False,
            68: False,
            69: False,
            70: False,
            71: False,
            72: False,
            73: False,
            74: False,
            75: False,
            76: False,
            77: False,
            78: False,
            79: False,
            80: False,
            81: False,
            82: False,
            83: False,
            84: False,
            85: False,
            86: False,
            87: False,
            88: False,
        },
        "SS./SM.": {
            0: True,
            1: True,
            2: True,
            3: True,
            4: True,
            5: True,
            6: True,
            7: True,
            8: True,
            9: True,
            10: True,
            11: True,
            12: True,
            13: True,
            14: True,
            15: True,
            16: True,
            17: True,
            18: True,
            19: True,
            20: True,
            21: True,
            22: True,
            23: True,
            24: True,
            25: True,
            26: True,
            27: True,
            28: True,
            29: True,
            30: True,
            31: True,
            32: True,
            33: False,
            34: False,
            35: True,
            36: True,
            37: True,
            38: True,
            39: True,
            40: True,
            41: True,
            42: True,
            43: True,
            44: True,
            45: True,
            46: True,
            47: True,
            48: True,
            49: True,
            50: True,
            51: True,
            52: True,
            53: True,
            54: True,
            55: True,
            56: True,
            57: True,
            58: True,
            59: True,
            60: True,
            61: True,
            62: True,
            63: True,
            64: True,
            65: True,
            66: True,
            67: True,
            68: True,
            69: True,
            70: True,
            71: True,
            72: True,
            73: True,
            74: True,
            75: True,
            76: True,
            77: True,
            78: True,
            79: True,
            80: True,
            81: True,
            82: True,
            83: True,
            84: True,
            85: True,
            86: False,
            87: False,
            88: True,
        },
    }
)


def test_check_ex_par_errors_int_loc_missing_1(patched_path_constants_1):
    """integration test with patched paths 1"""
    meetpunt_config = MptConfigChecker()
    ex_par_sheet, int_loc_sheet = meetpunt_config.check_ex_par_errors_int_loc_missing(
        ex_par_sheet_name="blaat1", int_loc_sheet_name="blaat2"
    )
    assert isinstance(ex_par_sheet, ExcelSheet) and isinstance(int_loc_sheet, ExcelSheet)
    assert ex_par_sheet.name == "blaat1" and int_loc_sheet.name == "blaat2"
    assert (ex_par_sheet.sheet_type and int_loc_sheet.sheet_type) == ExcelSheetTypeChoices.output_check
    assert ex_par_sheet.nr_rows == 89
    assert int_loc_sheet.nr_rows == 0

    # ensure ordered dfs (index and column)
    ex_par_sheet.df = ex_par_sheet.df.sort_index().sort_index(axis=1)
    expected_df = expected_df_ex_par_1_and_2.sort_index().sort_index(axis=1)
    assert ex_par_sheet.df.equals(expected_df)


def test_check_ex_par_errors_int_loc_missing_2(patched_path_constants_2):
    """integration test with patched paths 2"""
    meetpunt_config = MptConfigChecker()
    ex_par_sheet, int_loc_sheet = meetpunt_config.check_ex_par_errors_int_loc_missing(
        ex_par_sheet_name="blaat1", int_loc_sheet_name="blaat2"
    )
    assert isinstance(ex_par_sheet, ExcelSheet) and isinstance(int_loc_sheet, ExcelSheet)
    assert ex_par_sheet.name == "blaat1" and int_loc_sheet.name == "blaat2"
    assert (ex_par_sheet.sheet_type and int_loc_sheet.sheet_type) == ExcelSheetTypeChoices.output_check
    assert ex_par_sheet.nr_rows == 89
    assert int_loc_sheet.nr_rows == 0

    # ensure ordered dfs (index and column)
    ex_par_sheet.df = ex_par_sheet.df.sort_index().sort_index(axis=1)
    expected_df = expected_df_ex_par_1_and_2.sort_index().sort_index(axis=1)
    assert ex_par_sheet.df.equals(expected_df)
