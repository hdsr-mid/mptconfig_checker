from mptconfig.checker import MptConfigChecker
from mptconfig.excel import ExcelSheet
from mptconfig.excel import ExcelSheetTypeChoices
from mptconfig.tests.fixtures import patched_path_constants_1
from mptconfig.tests.fixtures import patched_path_constants_2
from mptconfig.utils import equal_dataframes

import pandas as pd  # noqa pandas comes with geopandas


# silence flake8 errors
_patched_path_constants_1 = patched_path_constants_1
_patched_path_constants_2 = patched_path_constants_2


expected_df_1 = pd.DataFrame(
    {
        "internalLocation": {
            0: "KW100412",
            1: "KW100923",
            2: "KW101012",
            3: "KW101313",
            4: "KW102011",
            5: "KW104812",
            6: "KW107912",
            7: "KW108011",
            8: "KW210314",
            9: "KW210414",
            10: "KW211114",
            11: "KW211312",
            12: "KW211412",
            13: "KW212212",
            14: "KW212614",
            15: "KW212814",
            16: "KW212815",
            17: "KW212816",
            18: "KW213114",
            19: "KW213512",
            20: "KW213612",
            21: "KW213714",
            22: "KW214012",
            23: "KW215314",
            24: "KW216013",
            25: "KW216114",
            26: "KW216613",
            27: "KW217013",
            28: "KW217014",
            29: "KW217712",
            30: "KW322312",
            31: "KW322512",
            32: "KW322814",
            33: "KW323014",
            34: "KW323016",
            35: "KW323514",
            36: "KW431014",
            37: "KW431213",
            38: "KW431523",
            39: "KW432223",
            40: "KW432912",
            41: "KW432913",
            42: "KW433114",
            43: "KW433213",
            44: "KW435714",
            45: "KW436414",
            46: "KW436613",
            47: "KW436713",
            48: "KW437014",
            49: "KW437812",
            50: "KW437822",
            51: "KW437823",
            52: "KW438912",
            53: "KW439012",
            54: "KW439412",
            55: "KW440712",
        },
        "eind": {
            0: pd.Timestamp("2100-01-01 00:00:00"),
            1: pd.Timestamp("2100-01-01 00:00:00"),
            2: pd.Timestamp("2100-01-01 00:00:00"),
            3: pd.Timestamp("2100-01-01 00:00:00"),
            4: pd.Timestamp("2100-01-01 00:00:00"),
            5: pd.Timestamp("2100-01-01 00:00:00"),
            6: pd.Timestamp("2100-01-01 00:00:00"),
            7: pd.Timestamp("2100-01-01 00:00:00"),
            8: pd.Timestamp("2100-01-01 00:00:00"),
            9: pd.Timestamp("2100-01-01 00:00:00"),
            10: pd.Timestamp("2100-01-01 00:00:00"),
            11: pd.Timestamp("2100-01-01 00:00:00"),
            12: pd.Timestamp("2100-01-01 00:00:00"),
            13: pd.Timestamp("2100-01-01 00:00:00"),
            14: pd.Timestamp("2100-01-01 00:00:00"),
            15: pd.Timestamp("2100-01-01 00:00:00"),
            16: pd.Timestamp("2100-01-01 00:00:00"),
            17: pd.Timestamp("2100-01-01 00:00:00"),
            18: pd.Timestamp("2100-01-01 00:00:00"),
            19: pd.Timestamp("2100-01-01 00:00:00"),
            20: pd.Timestamp("2100-01-01 00:00:00"),
            21: pd.Timestamp("2100-01-01 00:00:00"),
            22: pd.Timestamp("2100-01-01 00:00:00"),
            23: pd.Timestamp("2100-01-01 00:00:00"),
            24: pd.Timestamp("2100-01-01 00:00:00"),
            25: pd.Timestamp("2100-01-01 00:00:00"),
            26: pd.Timestamp("2100-01-01 00:00:00"),
            27: pd.Timestamp("2100-01-01 00:00:00"),
            28: pd.Timestamp("2100-01-01 00:00:00"),
            29: pd.Timestamp("2100-01-01 00:00:00"),
            30: pd.Timestamp("2100-01-01 00:00:00"),
            31: pd.Timestamp("2100-01-01 00:00:00"),
            32: pd.Timestamp("2100-01-01 00:00:00"),
            33: pd.Timestamp("2100-01-01 00:00:00"),
            34: pd.Timestamp("2100-01-01 00:00:00"),
            35: pd.Timestamp("2100-01-01 00:00:00"),
            36: pd.Timestamp("2100-01-01 00:00:00"),
            37: pd.Timestamp("2100-01-01 00:00:00"),
            38: pd.Timestamp("2100-01-01 00:00:00"),
            39: pd.Timestamp("2100-01-01 00:00:00"),
            40: pd.Timestamp("2100-01-01 00:00:00"),
            41: pd.Timestamp("2100-01-01 00:00:00"),
            42: pd.Timestamp("2100-01-01 00:00:00"),
            43: pd.Timestamp("2100-01-01 00:00:00"),
            44: pd.Timestamp("2100-01-01 00:00:00"),
            45: pd.Timestamp("2100-01-01 00:00:00"),
            46: pd.Timestamp("2100-01-01 00:00:00"),
            47: pd.Timestamp("2100-01-01 00:00:00"),
            48: pd.Timestamp("2100-01-01 00:00:00"),
            49: pd.Timestamp("2100-01-01 00:00:00"),
            50: pd.Timestamp("2100-01-01 00:00:00"),
            51: pd.Timestamp("2100-01-01 00:00:00"),
            52: pd.Timestamp("2100-01-01 00:00:00"),
            53: pd.Timestamp("2100-01-01 00:00:00"),
            54: pd.Timestamp("2100-01-01 00:00:00"),
            55: pd.Timestamp("2100-01-01 00:00:00"),
        },
        "internalParameters": {
            0: "Hk.0,Q.G.0",
            1: "DD.15,F.0,IB.0,Q.G.0",
            2: "Hk.0",
            3: "Hk.0,Q.G.0",
            4: "DD.15,F.0,IB.0,Q.G.0",
            5: "Hk.0,Q.G.0",
            6: "Hk.0,Q.G.0",
            7: "DD.15,IB.0,Q.G.0",
            8: "DD.15,F.0,IB.0,Q.G.0",
            9: "DD.15,F.0,IB.0,Q.G.0",
            10: "DD.15,F.0,IB.0,Q.G.0",
            11: "ES.0,Hk.0,Q.G.0",
            12: "ES.0,Hk.0,Q.G.0",
            13: "DD.15,IB.0,Q.G.0",
            14: "DD.15,F.0,IB.0,Q.G.0",
            15: "ES.0,POS.0,Q.G.0",
            16: "ES.0,POS.0,Q.G.0",
            17: "ES.0,POS.0,Q.G.0",
            18: "DD.15,F.0,IB.0,Q.G.0",
            19: "Hk.0,Q.G.0",
            20: "DD.15,F.0,IB.0,Q.G.0",
            21: "DD.15,IB.0,Q.G.0",
            22: "DD.15,F.0,IB.0,Q.G.0",
            23: "DD.15,F.0,IB.0,Q.G.0",
            24: "ES.0",
            25: "DD.15,F.0,IB.0,Q.G.0",
            26: "ES.0,Hh.0,Q.G.0",
            27: "DD.15,IB.0,Q.G.0",
            28: "Hk.0,Q.G.0",
            29: "DD.15,IB.0",
            30: "Hk.0,Q.G.0",
            31: "ES.0,Hk.0,Q.G.0",
            32: "DD.15,F.0,IB.0,Q.G.0,TT.15",
            33: "DD.15,F.0,IB.0,Q.G.0",
            34: "Q.G.0",
            35: "DD.15,F.0,IB.0,Q.G.0",
            36: "ES.0,POS.0,Q.G.0",
            37: "DD.15,F.0,IB.0,Q.G.0",
            38: "DD.15,IB.0,Q.G.0",
            39: "DD.15,F.0,IB.0,Q.G.0",
            40: "POS.0,POS2.0,Q.G.0",
            41: "POS.0,POS2.0,Q.G.0",
            42: "DD.15,F.0,IB.0,Q.G.0",
            43: "Hk.0,Q.G.0",
            44: "DD.15,F.0,IB.0,Q.G.0",
            45: "DD.15,F.0,IB.0,Q.G.0",
            46: "DD.15,F.0,IB.0,Q.G.0",
            47: "DD.15,F.0,IB.0,Q.G.0",
            48: "DD.15,F.0,IB.0,Q.G.0",
            49: "Hk.0,Q.G.0",
            50: "DD.15,F.0,IB.0,Q.G.0",
            51: "Hk.0,Q.G.0",
            52: "Hk.0,Q.G.0",
            53: "Hk.0,Q.G.0",
            54: "DD.15,F.0,IB.0,Q.G.0",
            55: "DD.15,F.0,IB.0,Q.G.0",
        },
        "externalParameters": {
            0: "Q1,SW1",
            1: "FQ3,I2B,IB2,Q6",
            2: "SW1",
            3: "Q3,SW1",
            4: "FQ1,I1B,IB1,Q2",
            5: "Q2,SW2",
            6: "Q2,SW1",
            7: "I1B,IB1,Q1",
            8: "FQ2,I2B,IB2,Q2",
            9: "FQ2,I2B,IB2,Q2",
            10: "FQ2,I2B,IB2,Q2",
            11: "ES1,Q1,SW1",
            12: "ES1,Q1,SW1",
            13: "I2B,IB2,Q2",
            14: "FQ2,I2B,IB2,Q2",
            15: "ES2,Q2,SP2",
            16: "ES3,Q3,SP3",
            17: "ES4,Q4,SP4",
            18: "FQ2,I2B,IB2,Q2",
            19: "Q2,SW2",
            20: "FQ2,I2B,IB2,Q2",
            21: "I2B,IB2,Q2",
            22: "FQ2,I2B,IB2,Q2",
            23: "FQ2,I2B,IB2,Q2",
            24: "ES1",
            25: "FQ2,I2B,IB2,Q2",
            26: "ES1,Q2,SS1",
            27: "I2B,IB2,Q2",
            28: "Q3,SW1",
            29: "I1B,IB1",
            30: "Q1,SW1",
            31: "ES2,Q2,SW2",
            32: "FQ2,I2B,IB2,Q2,TT2",
            33: "FQ2,I2B,IB2,Q2",
            34: "Q4",
            35: "FQ2,I2B,IB2,Q2",
            36: "ES1,Q4,SP1",
            37: "FQ2,I2B,IB2,Q2",
            38: "I2B,IB2,Q3",
            39: "FQ2,I2B,IB2,Q3",
            40: "Q2,SP2,SP3",
            41: "Q3,SP4,SP5",
            42: "FQ2,I2B,IB2,Q3",
            43: "Q1,SW1",
            44: "FQ2,I2B,IB2,Q2",
            45: "FQ2,I2B,IB2,Q3",
            46: "FQ2,I2B,IB2,Q2",
            47: "FQ2,I2B,IB2,Q2",
            48: "FQ2,I2B,IB2,Q2",
            49: "Q6,SW1",
            50: "FQ3,I3B,IB3,Q2",
            51: "Q3,SW2",
            52: "Q2,SW1",
            53: "Q2,SW1",
            54: "FQ2,I2B,IB2,Q2",
            55: "FQ2,I2B,IB2,Q2",
        },
        "externalLocations": {
            0: "004,1004",
            1: "009,1009,1802",
            2: "010,1010",
            3: "013,1013",
            4: "020,1020",
            5: "048,1048",
            6: "079,1079",
            7: "080,1080",
            8: "103,2103",
            9: "104,2104",
            10: "111,2111",
            11: "113,2113",
            12: "114,2114",
            13: "122,2122",
            14: "126,2126",
            15: "128,2128",
            16: "128,2128",
            17: "128,2128",
            18: "131,2131",
            19: "135,2135",
            20: "136,2136",
            21: "137,2137",
            22: "140,2140",
            23: "153,2153",
            24: "2160",
            25: "161,2161",
            26: "166,2166",
            27: "170,2170",
            28: "170,2170",
            29: "177,2177",
            30: "223,3223",
            31: "225,3225",
            32: "228,3228",
            33: "230,3230",
            34: "3230",
            35: "235,3235",
            36: "310",
            37: "312,4312",
            38: "315,4315",
            39: "322,4322",
            40: "329,4329",
            41: "329,4329",
            42: "331,4331",
            43: "332,4332",
            44: "357,4357",
            45: "364,4364",
            46: "366,4366",
            47: "367,4367",
            48: "370,4370",
            49: "378,4378,4810",
            50: "378,4378",
            51: "378,4378",
            52: "389,4389",
            53: "390,4390",
            54: "394,4394",
            55: "4407",
        },
        "error_type": {
            0: "stuw",
            1: "pompvijzel",
            2: "stuw",
            3: "stuw",
            4: "pompvijzel",
            5: "stuw",
            6: "stuw",
            7: "pompvijzel",
            8: "pompvijzel",
            9: "pompvijzel",
            10: "pompvijzel",
            11: "stuw",
            12: "stuw",
            13: "pompvijzel",
            14: "pompvijzel",
            15: "schuif",
            16: "schuif",
            17: "schuif",
            18: "pompvijzel",
            19: "stuw",
            20: "pompvijzel",
            21: "pompvijzel",
            22: "pompvijzel",
            23: "pompvijzel",
            24: "schuif",
            25: "pompvijzel",
            26: "schuif",
            27: "pompvijzel",
            28: "stuw",
            29: "pompvijzel",
            30: "stuw",
            31: "stuw",
            32: "pompvijzel",
            33: "pompvijzel",
            34: "schuif",
            35: "pompvijzel",
            36: "schuif",
            37: "pompvijzel",
            38: "pompvijzel",
            39: "pompvijzel",
            40: "schuif",
            41: "schuif",
            42: "pompvijzel",
            43: "stuw",
            44: "pompvijzel",
            45: "pompvijzel",
            46: "pompvijzel",
            47: "pompvijzel",
            48: "pompvijzel",
            49: "stuw",
            50: "pompvijzel",
            51: "stuw",
            52: "stuw",
            53: "stuw",
            54: "pompvijzel",
            55: "pompvijzel",
        },
        "error": {
            0: "stuw zonder stuurpeil KW100411 wel",
            1: "pompvijzel zonder stuurpeil KW100922 wel",
            2: "stuw zonder stuurpeil KW101011 wel",
            3: "stuw zonder stuurpeil KW101312 wel",
            4: "pompvijzel zonder stuurpeil KW102012 wel",
            5: "stuw zonder stuurpeil KW104811 wel",
            6: "stuw zonder stuurpeil KW107911 wel",
            7: "pompvijzel zonder stuurpeil KW108012 wel",
            8: "pompvijzel zonder stuurpeil KW210313 wel",
            9: "pompvijzel zonder stuurpeil KW210413 wel",
            10: "pompvijzel zonder stuurpeil KW211113 wel",
            11: "stuw zonder stuurpeil KW211311 wel",
            12: "stuw zonder stuurpeil KW211411 wel",
            13: "pompvijzel zonder stuurpeil KW212211 wel",
            14: "pompvijzel zonder stuurpeil KW212613 wel",
            15: "schuif zonder stuurpeil KW212813 wel",
            16: "schuif zonder stuurpeil KW212813 wel",
            17: "schuif zonder stuurpeil KW212813 wel",
            18: "pompvijzel zonder stuurpeil KW213113 wel",
            19: "stuw zonder stuurpeil KW213511 wel",
            20: "pompvijzel zonder stuurpeil KW213611 wel",
            21: "pompvijzel zonder stuurpeil KW213713 wel",
            22: "pompvijzel zonder stuurpeil KW214011 wel",
            23: "pompvijzel zonder stuurpeil KW215313 wel",
            24: "schuif zonder stuurpeil KW216012 wel",
            25: "pompvijzel zonder stuurpeil KW216113 wel",
            26: "schuif zonder stuurpeil KW216612 wel",
            27: "pompvijzel zonder stuurpeil KW217012 wel",
            28: "stuw zonder stuurpeil KW217012 wel",
            29: "pompvijzel zonder stuurpeil KW217711 wel",
            30: "stuw zonder stuurpeil KW322311 wel",
            31: "stuw zonder stuurpeil KW322511 wel",
            32: "pompvijzel zonder stuurpeil KW322813,KW322815 wel",
            33: "pompvijzel zonder stuurpeil KW323013 wel",
            34: "schuif zonder stuurpeil KW323013 wel",
            35: "pompvijzel zonder stuurpeil KW323513 wel",
            36: "schuif zonder stuurpeil KW431012,KW431013 wel",
            37: "pompvijzel zonder stuurpeil KW431212 wel",
            38: "pompvijzel zonder stuurpeil KW431522 wel",
            39: "pompvijzel zonder stuurpeil KW432222,KW432224 wel",
            40: "schuif zonder stuurpeil KW432911,KW432915 wel",
            41: "schuif zonder stuurpeil KW432911,KW432915 wel",
            42: "pompvijzel zonder stuurpeil KW433113,KW433115 wel",
            43: "stuw zonder stuurpeil KW433212 wel",
            44: "pompvijzel zonder stuurpeil KW435713 wel",
            45: "pompvijzel zonder stuurpeil KW436413 wel",
            46: "pompvijzel zonder stuurpeil KW436612 wel",
            47: "pompvijzel zonder stuurpeil KW436712 wel",
            48: "pompvijzel zonder stuurpeil KW437013,KW437015 wel",
            49: "stuw zonder stuurpeil KW437811 wel",
            50: "pompvijzel zonder stuurpeil KW437821 wel",
            51: "stuw zonder stuurpeil KW437821 wel",
            52: "stuw zonder stuurpeil KW438911 wel",
            53: "stuw zonder stuurpeil KW439011 wel",
            54: "pompvijzel zonder stuurpeil KW439411 wel",
            55: "pompvijzel zonder stuurpeil KW440711 wel",
        },
    }
)

expected_df_2 = pd.DataFrame(
    {
        "internalLocation": {0: "KW218619"},
        "eind": {0: pd.Timestamp("2100-01-01 00:00:00")},
        "internalParameters": {0: "ES.0,POS.0,Q.G.0"},
        "externalParameters": {0: "ES3,Q4,SP5"},
        "externalLocations": {0: "2186"},
        "error_type": {0: "schuif"},
        "error": {0: "schuif zonder stuurpeil KW218611,KW218612 wel"},
    }
)


def test_check_timeseries_logic_1(patched_path_constants_1):
    """integration test with patched paths 1"""
    meetpunt_config = MptConfigChecker()
    excelsheet = meetpunt_config.check_timeseries_logic(sheet_name="blabla")
    assert isinstance(excelsheet, ExcelSheet)
    assert excelsheet.name == "blabla"
    assert excelsheet.sheet_type == ExcelSheetTypeChoices.output_check
    assert excelsheet.nr_rows == 56
    assert equal_dataframes(expected_df=expected_df_1, test_df=excelsheet.df)


def test_check_timeseries_logic_2(patched_path_constants_2):
    """integration test with patched paths 2"""
    meetpunt_config = MptConfigChecker()
    excelsheet = meetpunt_config.check_timeseries_logic(sheet_name="blabla")
    assert isinstance(excelsheet, ExcelSheet)
    assert excelsheet.name == "blabla"
    assert excelsheet.sheet_type == ExcelSheetTypeChoices.output_check
    assert excelsheet.nr_rows == 1
    assert equal_dataframes(expected_df=expected_df_2, test_df=excelsheet.df)
