from mptconfig.checker import MptConfigChecker
from mptconfig.excel import ExcelSheet
from mptconfig.excel import ExcelSheetTypeChoices
from mptconfig.tests.fixtures import patched_path_constants_1
from mptconfig.tests.fixtures import patched_path_constants_2
from mptconfig.tests.utils import equal_dataframes

import pandas as pd  # noqa pandas comes with geopandas


# silence flake8 errors
_patched_path_constants_1 = patched_path_constants_1
_patched_path_constants_2 = patched_path_constants_2


expected_df_1 = pd.DataFrame(
    {
        "internalLocation": {
            0: "KW100412",
            1: "KW100923",
            2: "KW101012",
            3: "KW101313",
            4: "KW102011",
            5: "KW104812",
            6: "KW106112",
            7: "KW107912",
            8: "KW108011",
            9: "KW210314",
            10: "KW210414",
            11: "KW211114",
            12: "KW211312",
            13: "KW211412",
            14: "KW212212",
            15: "KW212614",
            16: "KW212814",
            17: "KW212815",
            18: "KW212816",
            19: "KW213114",
            20: "KW213512",
            21: "KW213612",
            22: "KW213714",
            23: "KW214012",
            24: "KW215314",
            25: "KW216013",
            26: "KW216114",
            27: "KW216613",
            28: "KW217013",
            29: "KW217014",
            30: "KW217712",
            31: "KW218613",
            32: "KW218614",
            33: "KW322312",
            34: "KW322512",
            35: "KW322814",
            36: "KW323014",
            37: "KW323016",
            38: "KW323514",
            39: "KW323515",
            40: "KW324813",
            41: "KW431014",
            42: "KW431213",
            43: "KW431523",
            44: "KW432223",
            45: "KW432912",
            46: "KW432913",
            47: "KW433114",
            48: "KW433213",
            49: "KW435013",
            50: "KW435714",
            51: "KW436414",
            52: "KW436613",
            53: "KW436713",
            54: "KW437014",
            55: "KW437812",
            56: "KW437822",
            57: "KW437823",
            58: "KW438912",
            59: "KW439012",
            60: "KW439412",
            61: "KW440712",
        },
        "eind": {
            0: pd.Timestamp("2100-01-01 00:00:00"),
            1: pd.Timestamp("2100-01-01 00:00:00"),
            2: pd.Timestamp("2100-01-01 00:00:00"),
            3: pd.Timestamp("2100-01-01 00:00:00"),
            4: pd.Timestamp("2100-01-01 00:00:00"),
            5: pd.Timestamp("2100-01-01 00:00:00"),
            6: pd.Timestamp("2100-01-01 00:00:00"),
            7: pd.Timestamp("2100-01-01 00:00:00"),
            8: pd.Timestamp("2100-01-01 00:00:00"),
            9: pd.Timestamp("2100-01-01 00:00:00"),
            10: pd.Timestamp("2100-01-01 00:00:00"),
            11: pd.Timestamp("2100-01-01 00:00:00"),
            12: pd.Timestamp("2100-01-01 00:00:00"),
            13: pd.Timestamp("2100-01-01 00:00:00"),
            14: pd.Timestamp("2100-01-01 00:00:00"),
            15: pd.Timestamp("2100-01-01 00:00:00"),
            16: pd.Timestamp("2100-01-01 00:00:00"),
            17: pd.Timestamp("2100-01-01 00:00:00"),
            18: pd.Timestamp("2100-01-01 00:00:00"),
            19: pd.Timestamp("2100-01-01 00:00:00"),
            20: pd.Timestamp("2100-01-01 00:00:00"),
            21: pd.Timestamp("2100-01-01 00:00:00"),
            22: pd.Timestamp("2100-01-01 00:00:00"),
            23: pd.Timestamp("2100-01-01 00:00:00"),
            24: pd.Timestamp("2100-01-01 00:00:00"),
            25: pd.Timestamp("2100-01-01 00:00:00"),
            26: pd.Timestamp("2100-01-01 00:00:00"),
            27: pd.Timestamp("2100-01-01 00:00:00"),
            28: pd.Timestamp("2100-01-01 00:00:00"),
            29: pd.Timestamp("2100-01-01 00:00:00"),
            30: pd.Timestamp("2100-01-01 00:00:00"),
            31: pd.Timestamp("2100-01-01 00:00:00"),
            32: pd.Timestamp("2100-01-01 00:00:00"),
            33: pd.Timestamp("2100-01-01 00:00:00"),
            34: pd.Timestamp("2100-01-01 00:00:00"),
            35: pd.Timestamp("2100-01-01 00:00:00"),
            36: pd.Timestamp("2100-01-01 00:00:00"),
            37: pd.Timestamp("2100-01-01 00:00:00"),
            38: pd.Timestamp("2100-01-01 00:00:00"),
            39: pd.Timestamp("2100-01-01 00:00:00"),
            40: pd.Timestamp("2100-01-01 00:00:00"),
            41: pd.Timestamp("2100-01-01 00:00:00"),
            42: pd.Timestamp("2100-01-01 00:00:00"),
            43: pd.Timestamp("2100-01-01 00:00:00"),
            44: pd.Timestamp("2100-01-01 00:00:00"),
            45: pd.Timestamp("2100-01-01 00:00:00"),
            46: pd.Timestamp("2100-01-01 00:00:00"),
            47: pd.Timestamp("2100-01-01 00:00:00"),
            48: pd.Timestamp("2100-01-01 00:00:00"),
            49: pd.Timestamp("2100-01-01 00:00:00"),
            50: pd.Timestamp("2100-01-01 00:00:00"),
            51: pd.Timestamp("2100-01-01 00:00:00"),
            52: pd.Timestamp("2100-01-01 00:00:00"),
            53: pd.Timestamp("2100-01-01 00:00:00"),
            54: pd.Timestamp("2100-01-01 00:00:00"),
            55: pd.Timestamp("2100-01-01 00:00:00"),
            56: pd.Timestamp("2100-01-01 00:00:00"),
            57: pd.Timestamp("2100-01-01 00:00:00"),
            58: pd.Timestamp("2100-01-01 00:00:00"),
            59: pd.Timestamp("2100-01-01 00:00:00"),
            60: pd.Timestamp("2100-01-01 00:00:00"),
            61: pd.Timestamp("2100-01-01 00:00:00"),
        },
        "internalParameters": {
            0: "Hk.0,Q.G.0",
            1: "DD.15,F.0,IB.0,Q.G.0",
            2: "Hk.0",
            3: "Hk.0,Q.G.0",
            4: "DD.15,F.0,IB.0,Q.G.0",
            5: "Hk.0,Q.G.0",
            6: "Q.G.0",
            7: "Hk.0,Q.G.0",
            8: "DD.15,IB.0,Q.G.0",
            9: "DD.15,F.0,IB.0,Q.G.0",
            10: "DD.15,F.0,IB.0,Q.G.0",
            11: "DD.15,F.0,IB.0,Q.G.0",
            12: "ES.0,Hk.0,Q.G.0",
            13: "ES.0,Hk.0,Q.G.0",
            14: "DD.15,IB.0,Q.G.0",
            15: "DD.15,F.0,IB.0,Q.G.0",
            16: "ES.0,POS.0,Q.G.0",
            17: "ES.0,POS.0,Q.G.0",
            18: "ES.0,POS.0,Q.G.0",
            19: "DD.15,F.0,IB.0,Q.G.0",
            20: "Hk.0,Q.G.0",
            21: "DD.15,F.0,IB.0,Q.G.0",
            22: "DD.15,IB.0,Q.G.0",
            23: "DD.15,F.0,IB.0,Q.G.0",
            24: "DD.15,F.0,IB.0,Q.G.0",
            25: "ES.0",
            26: "DD.15,F.0,IB.0,Q.G.0",
            27: "ES.0,Hh.0,Q.G.0",
            28: "DD.15,IB.0,Q.G.0",
            29: "Hk.0,Q.G.0",
            30: "DD.15,IB.0",
            31: "ES.0,POS.0",
            32: "ES.0,POS.0",
            33: "Hk.0,Q.G.0",
            34: "ES.0,Hk.0,Q.G.0",
            35: "DD.15,F.0,IB.0,Q.G.0,TT.15",
            36: "DD.15,F.0,IB.0,Q.G.0",
            37: "Q.G.0",
            38: "DD.15,F.0,IB.0,Q.G.0",
            39: "POS.0,Q.G.0",
            40: "DD.15,IB.0",
            41: "ES.0,POS.0,Q.G.0",
            42: "DD.15,F.0,IB.0,Q.G.0",
            43: "DD.15,IB.0,Q.G.0",
            44: "DD.15,F.0,IB.0,Q.G.0",
            45: "POS.0,POS2.0,Q.G.0",
            46: "POS.0,POS2.0,Q.G.0",
            47: "DD.15,F.0,IB.0,Q.G.0",
            48: "Hk.0,Q.G.0",
            49: "ES.0,POS.0,Q.G.0",
            50: "DD.15,F.0,IB.0,Q.G.0",
            51: "DD.15,F.0,IB.0,Q.G.0",
            52: "DD.15,F.0,IB.0,Q.G.0",
            53: "DD.15,F.0,IB.0,Q.G.0",
            54: "DD.15,F.0,IB.0,Q.G.0",
            55: "Hk.0,Q.G.0",
            56: "DD.15,F.0,IB.0,Q.G.0",
            57: "Hk.0,Q.G.0",
            58: "Hk.0,Q.G.0",
            59: "Hk.0,Q.G.0",
            60: "DD.15,F.0,IB.0,Q.G.0",
            61: "DD.15,F.0,IB.0,Q.G.0",
        },
        "externalParameters": {
            0: "Q1,SW1",
            1: "FQ3,I2B,IB2,Q6",
            2: "SW1",
            3: "Q3,SW1",
            4: "FQ1,I1B,IB1,Q2",
            5: "Q2,SW2",
            6: "Q2",
            7: "Q2,SW1",
            8: "I1B,IB1,Q1",
            9: "FQ2,I2B,IB2,Q2",
            10: "FQ2,I2B,IB2,Q2",
            11: "FQ2,I2B,IB2,Q2",
            12: "ES1,Q1,SW1",
            13: "ES1,Q1,SW1",
            14: "I2B,IB2,Q2",
            15: "FQ2,I2B,IB2,Q2",
            16: "ES2,Q2,SP2",
            17: "ES3,Q3,SP3",
            18: "ES4,Q4,SP4",
            19: "FQ2,I2B,IB2,Q2",
            20: "Q2,SW2",
            21: "FQ2,I2B,IB2,Q2",
            22: "I2B,IB2,Q2",
            23: "FQ2,I2B,IB2,Q2",
            24: "FQ2,I2B,IB2,Q2",
            25: "ES1",
            26: "FQ2,I2B,IB2,Q2",
            27: "ES1,Q2,SS1",
            28: "I2B,IB2,Q2",
            29: "Q3,SW1",
            30: "I1B,IB1",
            31: "ES1,SP1",
            32: "ES2,SP2",
            33: "Q1,SW1",
            34: "ES2,Q2,SW2",
            35: "FQ2,I2B,IB2,Q2,TT2",
            36: "FQ2,I2B,IB2,Q2",
            37: "Q4",
            38: "FQ2,I2B,IB2,Q2",
            39: "Q4,SP1",
            40: "I2B,IB2",
            41: "ES1,Q4,SP1",
            42: "FQ2,I2B,IB2,Q2",
            43: "I2B,IB2,Q3",
            44: "FQ2,I2B,IB2,Q3",
            45: "Q2,SP2,SP3",
            46: "Q3,SP4,SP5",
            47: "FQ2,I2B,IB2,Q3",
            48: "Q1,SW1",
            49: "ES1,Q2,SP1",
            50: "FQ2,I2B,IB2,Q2",
            51: "FQ2,I2B,IB2,Q3",
            52: "FQ2,I2B,IB2,Q2",
            53: "FQ2,I2B,IB2,Q2",
            54: "FQ2,I2B,IB2,Q2",
            55: "Q6,SW1",
            56: "FQ3,I3B,IB3,Q2",
            57: "Q3,SW2",
            58: "Q2,SW1",
            59: "Q2,SW1",
            60: "FQ2,I2B,IB2,Q2",
            61: "FQ2,I2B,IB2,Q2",
        },
        "externalLocations": {
            0: "004,1004",
            1: "009,1009,1802",
            2: "010,1010",
            3: "013,1013",
            4: "020,1020",
            5: "048,1048",
            6: "1061",
            7: "079,1079",
            8: "080,1080",
            9: "103,2103",
            10: "104,2104",
            11: "111,2111",
            12: "113,2113",
            13: "114,2114",
            14: "122,2122",
            15: "126,2126",
            16: "128,2128",
            17: "128,2128",
            18: "128,2128",
            19: "131,2131",
            20: "135,2135",
            21: "136,2136",
            22: "137,2137",
            23: "140,2140",
            24: "153,2153",
            25: "2160",
            26: "161,2161",
            27: "166,2166",
            28: "170,2170",
            29: "170,2170",
            30: "177,2177",
            31: "186,2186",
            32: "186,2186",
            33: "223,3223",
            34: "225,3225",
            35: "228,3228",
            36: "230,3230",
            37: "3230",
            38: "235,3235",
            39: "235,3235",
            40: "248,3248",
            41: "310",
            42: "312,4312",
            43: "315,4315",
            44: "322,4322",
            45: "329,4329",
            46: "329,4329",
            47: "331,4331",
            48: "332,4332",
            49: "350,4350",
            50: "357,4357",
            51: "364,4364",
            52: "366,4366",
            53: "367,4367",
            54: "370,4370",
            55: "378,4378,4810",
            56: "378,4378",
            57: "378,4378",
            58: "389,4389",
            59: "390,4390",
            60: "394,4394",
            61: "4407",
        },
        "type": {
            0: "stuw",
            1: "pompvijzel",
            2: "stuw",
            3: "stuw",
            4: "pompvijzel",
            5: "stuw",
            6: "overlaat",
            7: "stuw",
            8: "pompvijzel",
            9: "pompvijzel",
            10: "pompvijzel",
            11: "pompvijzel",
            12: "stuw",
            13: "stuw",
            14: "pompvijzel",
            15: "pompvijzel",
            16: "schuif",
            17: "schuif",
            18: "schuif",
            19: "pompvijzel",
            20: "stuw",
            21: "pompvijzel",
            22: "pompvijzel",
            23: "pompvijzel",
            24: "pompvijzel",
            25: "schuif",
            26: "pompvijzel",
            27: "schuif",
            28: "pompvijzel",
            29: "stuw",
            30: "pompvijzel",
            31: "schuif",
            32: "schuif",
            33: "stuw",
            34: "stuw",
            35: "pompvijzel",
            36: "pompvijzel",
            37: "schuif",
            38: "pompvijzel",
            39: "schuif",
            40: "pompvijzel",
            41: "schuif",
            42: "pompvijzel",
            43: "pompvijzel",
            44: "pompvijzel",
            45: "schuif",
            46: "schuif",
            47: "pompvijzel",
            48: "stuw",
            49: "schuif",
            50: "pompvijzel",
            51: "pompvijzel",
            52: "pompvijzel",
            53: "pompvijzel",
            54: "pompvijzel",
            55: "stuw",
            56: "pompvijzel",
            57: "stuw",
            58: "stuw",
            59: "stuw",
            60: "pompvijzel",
            61: "pompvijzel",
        },
        "fout": {
            0: "stuw zonder stuurpeil KW100411 wel",
            1: "pompvijzel zonder stuurpeil KW100922 wel",
            2: "stuw zonder stuurpeil KW101011 wel",
            3: "stuw zonder stuurpeil KW101312 wel",
            4: "pompvijzel zonder stuurpeil KW102012 wel",
            5: "stuw zonder stuurpeil KW104811 wel",
            6: "overlaat zonder stuurpeil KW106111 wel",
            7: "stuw zonder stuurpeil KW107911 wel",
            8: "pompvijzel zonder stuurpeil KW108012 wel",
            9: "pompvijzel zonder stuurpeil KW210313 wel",
            10: "pompvijzel zonder stuurpeil KW210413 wel",
            11: "pompvijzel zonder stuurpeil KW211113 wel",
            12: "stuw zonder stuurpeil KW211311 wel",
            13: "stuw zonder stuurpeil KW211411 wel",
            14: "pompvijzel zonder stuurpeil KW212211 wel",
            15: "pompvijzel zonder stuurpeil KW212613 wel",
            16: "schuif zonder stuurpeil KW212813 wel",
            17: "schuif zonder stuurpeil KW212813 wel",
            18: "schuif zonder stuurpeil KW212813 wel",
            19: "pompvijzel zonder stuurpeil KW213113 wel",
            20: "stuw zonder stuurpeil KW213511 wel",
            21: "pompvijzel zonder stuurpeil KW213611 wel",
            22: "pompvijzel zonder stuurpeil KW213713 wel",
            23: "pompvijzel zonder stuurpeil KW214011 wel",
            24: "pompvijzel zonder stuurpeil KW215313 wel",
            25: "schuif zonder stuurpeil KW216012 wel",
            26: "pompvijzel zonder stuurpeil KW216113 wel",
            27: "schuif zonder stuurpeil KW216612 wel",
            28: "pompvijzel zonder stuurpeil KW217012 wel",
            29: "stuw zonder stuurpeil KW217012 wel",
            30: "pompvijzel zonder stuurpeil KW217711 wel",
            31: "schuif zonder stuurpeil KW218611,KW218612 wel",
            32: "schuif zonder stuurpeil KW218611,KW218612 wel",
            33: "stuw zonder stuurpeil KW322311 wel",
            34: "stuw zonder stuurpeil KW322511 wel",
            35: "pompvijzel zonder stuurpeil KW322813,KW322815 wel",
            36: "pompvijzel zonder stuurpeil KW323013 wel",
            37: "schuif zonder stuurpeil KW323013 wel",
            38: "pompvijzel zonder stuurpeil KW323513 wel",
            39: "schuif zonder stuurpeil KW323513 wel",
            40: "pompvijzel zonder stuurpeil KW324812 wel",
            41: "schuif zonder stuurpeil KW431012,KW431013 wel",
            42: "pompvijzel zonder stuurpeil KW431212 wel",
            43: "pompvijzel zonder stuurpeil KW431522 wel",
            44: "pompvijzel zonder stuurpeil KW432222,KW432224 wel",
            45: "schuif zonder stuurpeil KW432911,KW432915 wel",
            46: "schuif zonder stuurpeil KW432911,KW432915 wel",
            47: "pompvijzel zonder stuurpeil KW433113,KW433115 wel",
            48: "stuw zonder stuurpeil KW433212 wel",
            49: "schuif zonder stuurpeil KW435012 wel",
            50: "pompvijzel zonder stuurpeil KW435713 wel",
            51: "pompvijzel zonder stuurpeil KW436413 wel",
            52: "pompvijzel zonder stuurpeil KW436612 wel",
            53: "pompvijzel zonder stuurpeil KW436712 wel",
            54: "pompvijzel zonder stuurpeil KW437013,KW437015 wel",
            55: "stuw zonder stuurpeil KW437811 wel",
            56: "pompvijzel zonder stuurpeil KW437821 wel",
            57: "stuw zonder stuurpeil KW437821 wel",
            58: "stuw zonder stuurpeil KW438911 wel",
            59: "stuw zonder stuurpeil KW439011 wel",
            60: "pompvijzel zonder stuurpeil KW439411 wel",
            61: "pompvijzel zonder stuurpeil KW440711 wel",
        },
    }
)

expected_df_2 = pd.DataFrame(
    {
        "internalLocation": {
            0: "KW106112",
            1: "KW218613",
            2: "KW218614",
            3: "KW218619",
            4: "KW323515",
            5: "KW324813",
            6: "KW435013",
        },
        "eind": {
            0: pd.Timestamp("2100-01-01 00:00:00"),
            1: pd.Timestamp("2100-01-01 00:00:00"),
            2: pd.Timestamp("2100-01-01 00:00:00"),
            3: pd.Timestamp("2100-01-01 00:00:00"),
            4: pd.Timestamp("2100-01-01 00:00:00"),
            5: pd.Timestamp("2100-01-01 00:00:00"),
            6: pd.Timestamp("2100-01-01 00:00:00"),
        },
        "internalParameters": {
            0: "Q.G.0",
            1: "ES.0,POS.0",
            2: "ES.0,POS.0",
            3: "ES.0,POS.0,Q.G.0",
            4: "POS.0,Q.G.0",
            5: "DD.15,IB.0",
            6: "ES.0,POS.0,Q.G.0",
        },
        "externalParameters": {
            0: "Q2",
            1: "ES1,SP1",
            2: "ES2,SP2",
            3: "ES3,Q4,SP5",
            4: "Q4,SP1",
            5: "I2B,IB2",
            6: "ES1,Q2,SP1",
        },
        "externalLocations": {
            0: "1061",
            1: "186,2186",
            2: "186,2186",
            3: "2186",
            4: "235,3235",
            5: "248,3248",
            6: "350,4350",
        },
        "type": {0: "overlaat", 1: "afsluiter", 2: "afsluiter", 3: "schuif", 4: "schuif", 5: "pompvijzel", 6: "schuif"},
        "fout": {
            0: "overlaat zonder stuurpeil KW106111 wel",
            1: "afsluiter zonder stuurpeil KW218611,KW218612 wel",
            2: "afsluiter zonder stuurpeil KW218611,KW218612 wel",
            3: "schuif zonder stuurpeil KW218611,KW218612 wel",
            4: "schuif zonder stuurpeil KW323513,KW323514 wel",
            5: "pompvijzel zonder stuurpeil KW324812 wel",
            6: "schuif zonder stuurpeil KW435012 wel",
        },
    }
)


def test_check_timeseries_logic_1(patched_path_constants_1):
    """integration test with patched paths 1"""
    meetpunt_config = MptConfigChecker()
    excelsheet = meetpunt_config.check_timeseries_logic(sheet_name="blabla")
    assert isinstance(excelsheet, ExcelSheet)
    assert excelsheet.name == "blabla"
    assert excelsheet.sheet_type == ExcelSheetTypeChoices.output_check
    assert excelsheet.nr_rows == 62
    assert equal_dataframes(expected_df=expected_df_1, test_df=excelsheet.df)


def test_check_timeseries_logic_2(patched_path_constants_2):
    """integration test with patched paths 2"""
    meetpunt_config = MptConfigChecker()
    excelsheet = meetpunt_config.check_timeseries_logic(sheet_name="blabla")
    assert isinstance(excelsheet, ExcelSheet)
    assert excelsheet.name == "blabla"
    assert excelsheet.sheet_type == ExcelSheetTypeChoices.output_check
    assert excelsheet.nr_rows == 7
    assert equal_dataframes(expected_df=expected_df_2, test_df=excelsheet.df)
